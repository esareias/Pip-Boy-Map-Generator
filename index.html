
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pip-Boy Map Terminal</title>
    <!-- PeerJS -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    
    <style>
      :root {
        --pip-green: #16ff60;
        --pip-green-dim: #0f692e;
        --pip-amber: #ffb300;
        --pip-amber-dim: #8a5e00;
        --main-color: var(--pip-green);
        --dim-color: var(--pip-green-dim);
      }

      body {
        background-color: #000;
        font-family: 'VT323', monospace;
        overflow-x: hidden;
        background-image: radial-gradient(#1a1c1a 1px, #000 1px);
        background-size: 20px 20px;
        color: var(--main-color);
      }

      body.theme-green { --main-color: #16ff60; --dim-color: #0f692e; }
      body.theme-amber { --main-color: #ffb300; --dim-color: #8a5e00; }
      
      .pip-casing {
          border: 4px solid #3d443d;
          background-color: #1a1c1a;
          box-shadow: inset 0 0 60px #000, 0 0 50px rgba(0,0,0,0.8);
          border-radius: 20px;
          padding: 20px;
          max-width: 1200px;
          margin: 20px auto;
          position: relative;
          min-height: 800px;
          display: flex;
          flex-direction: column;
      }
      .pip-casing::before, .pip-casing::after {
          content: ''; position: absolute; width: 12px; height: 12px;
          background: #2a302a; border-radius: 50%;
          box-shadow: inset 1px 1px 2px #000, 1px 1px 0 #555;
          top: 10px;
      }
      .pip-casing::before { left: 10px; }
      .pip-casing::after { right: 10px; }

      .screen-container {
          position: relative;
          border: 4px solid #444;
          border-radius: 20px 20px 4px 4px;
          background-color: #050505;
          overflow: hidden;
          box-shadow: 0 0 40px rgba(0,0,0,0.9), inset 0 0 30px rgba(0,0,0,1);
          cursor: crosshair;
          flex-grow: 1;
      }

      .tracking-line {
          width: 100%; height: 2px;
          background: rgba(255,255,255,0.1);
          position: absolute; top: 0; left: 0; pointer-events: none; z-index: 42;
          animation: tracking 8s linear infinite;
          box-shadow: 0 0 10px rgba(255,255,255,0.2);
      }
      @keyframes tracking { 0% { top: -10%; opacity: 0; } 10% { opacity: 0.5; } 90% { opacity: 0.5; } 100% { top: 110%; opacity: 0; } }

      .crt-flicker {
          animation: flicker 0.15s infinite;
          pointer-events: none; position: absolute; inset: 0; z-index: 45;
          background: rgba(255,255,255,0.02);
          opacity: 0;
      }
      @keyframes flicker { 0% { opacity: 0.02; } 50% { opacity: 0.04; } 100% { opacity: 0.02; } }

      .pip-btn {
        background: #111; border: 2px solid var(--main-color); color: var(--main-color);
        text-transform: uppercase; padding: 4px 12px; font-size: 1.1rem; cursor: pointer;
        transition: all 0.1s; box-shadow: 0 4px 0 rgba(0,0,0,0.5); border-radius: 2px;
        position: relative; top: 0; text-shadow: 0 0 2px var(--main-color);
      }
      .pip-btn:active { top: 2px; box-shadow: 0 2px 0 rgba(0,0,0,0.5); }
      .pip-btn:hover { background: var(--dim-color); color: #fff; text-shadow: none; }
      .pip-btn:disabled { opacity: 0.4; cursor: not-allowed; pointer-events: none; border-color: #444; color: #888; box-shadow: none; }
      
      .pip-input {
        background: #000; border: 1px solid var(--dim-color); color: var(--main-color);
        padding: 5px; font-family: 'VT323', monospace; font-size: 1.2rem; border-radius: 0px;
        box-shadow: inset 0 0 5px rgba(0,0,0,0.5);
        outline: none;
      }

      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #000; }
      ::-webkit-scrollbar-thumb { background: var(--dim-color); border: 1px solid var(--main-color); }
      
      .hidden-ui { display: none !important; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0"
  }
}
</script>
</head>
<body class="theme-green">

    <!-- LOGIN OVERLAY -->
    <div id="loginOverlay" class="fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-4">
        <div class="border-4 border-[var(--main-color)] bg-[#0a0a0a] p-8 max-w-4xl w-full shadow-[0_0_50px_var(--dim-color)]">
            <h2 class="text-4xl text-center font-bold mb-2">IDENTITY CONFIRMATION</h2>
            <p class="text-center opacity-70 mb-8 text-xl">SELECT UNIT DESIGNATION</p>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8" id="characterGrid">
                <!-- Populated by JS -->
            </div>

            <div id="connectionControls" class="flex justify-center gap-4 mb-6 border-t border-[var(--dim-color)] pt-6">
                  <button id="initHostBtn" class="pip-btn text-xl px-8">INITIALIZE HOST</button>
                  <div class="flex gap-2">
                      <input id="hostIdInput" class="pip-input w-48 text-center text-lg" placeholder="ENTER HOST ID" />
                      <button id="connectBtn" class="pip-btn">CONNECT</button>
                  </div>
            </div>

            <div class="text-center">
                  <button id="enterSystemBtn" class="pip-btn text-2xl px-16 py-2 border-4 font-bold" disabled>
                      ENTER SYSTEM
                  </button>
            </div>
        </div>
    </div>

    <div class="pip-casing">
        
        <!-- HEADER -->
        <div class="flex justify-between items-end mb-4 border-b border-[var(--dim-color)] pb-2">
            <div>
                <h1 class="text-4xl font-bold tracking-wider" style="text-shadow: 0 0 10px var(--main-color)">CARTOGRAPHY MODULE</h1>
                <p class="opacity-70 tracking-widest text-lg">V.29.3 - VAULT-TEC PRO</p>
            </div>
            <div class="text-right opacity-60 text-sm">
                ROBCO INDUSTRIES<br/>UNIFIED OPERATING SYSTEM
            </div>
        </div>

        <!-- CONTROLS ROW -->
        <div class="flex justify-between items-center bg-black/40 p-2 mb-4 border border-[var(--dim-color)]">
             <div class="flex gap-4 items-center">
                <span class="opacity-70">SECTOR:</span>
                <span id="levelNameDisplay" class="font-bold text-xl">LEVEL 0 (GROUND)</span>
                <div class="h-6 w-px bg-[var(--main-color)] opacity-50"></div>
                <div id="aiAnalysisDisplay" class="text-xs opacity-80 max-w-md italic"></div>
             </div>
             <div class="flex gap-2">
                 <button id="aiAnalyzeBtn" class="pip-btn text-sm">AI ANALYZE</button>
                 <button id="loginBtn" class="pip-btn text-sm hidden-ui">LOGIN</button>
             </div>
        </div>

        <!-- MAIN SCREEN -->
        <div class="screen-container">
            <div class="tracking-line"></div>
            <div class="crt-flicker"></div>
            
            <!-- CONTROLS OVERLAY -->
            <div class="absolute top-4 left-4 z-20 flex gap-2">
                 <button id="levelDownBtn" class="pip-btn bg-black/80 backdrop-blur">▼ LOWER</button>
                 <button id="levelUpBtn" class="pip-btn bg-black/80 backdrop-blur">▲ UPPER</button>
                 <button id="scanBtn" class="pip-btn bg-black/80 backdrop-blur border-amber-500 text-amber-500">>> SCAN</button>
            </div>
            
            <div class="absolute bottom-2 left-2 z-20 bg-black/80 border border-[var(--dim-color)] px-2 py-1 text-sm font-bold">
                POS: <span id="coordDisplay">0,0</span>
            </div>

            <canvas id="mapCanvas" class="w-full h-full object-cover"></canvas>
        </div>

        <!-- LOG TERMINAL -->
        <div class="mt-4 flex gap-4 h-48">
             <div class="w-1/4 flex flex-col gap-2">
                 <div class="border border-[var(--dim-color)] p-2 flex-1 bg-black/20">
                     <div class="text-sm opacity-50 mb-1">SYSTEM STATUS</div>
                     <div id="connStatus" class="text-lg">OFFLINE</div>
                     <div id="hostModeDisplay" class="text-xs opacity-50">TERMINAL MODE</div>
                     <div id="peerIdDisplay" class="text-xs mt-2 break-all"></div>
                 </div>
                 <div class="border border-[var(--dim-color)] p-2">
                     <div class="text-xs opacity-50">MAP TYPE</div>
                     <select id="mapTypeSelect" class="pip-input w-full text-sm mt-1">
                         <option value="vault">VAULT</option>
                         <option value="ruins">RUINS</option>
                         <option value="cave">CAVE</option>
                     </select>
                 </div>
             </div>

             <div class="flex-1 flex flex-col border border-[var(--dim-color)] bg-black/40 p-2">
                 <div id="logContainer" class="flex-1 overflow-y-auto font-mono text-sm space-y-1 pr-2 mb-2">
                    <div class="border-b border-dashed border-[var(--dim-color)] pb-1 mb-1">
                        <span class="opacity-50 text-xs mr-2">SYSTEM</span>
                        <span>WELCOME TO ROBCO TERMINAL.</span>
                    </div>
                 </div>
                 <div class="flex gap-2">
                    <input id="chatInput" class="pip-input flex-1" placeholder="ENTER COMMAND..." />
                    <button id="transmitBtn" class="pip-btn">TRANSMIT</button>
                 </div>
             </div>
        </div>

    </div>

    <!-- MAIN LOGIC SCRIPT (NATIVE MODULE) -->
    <script type="module" src="./script.js"></script>
</body>
</html>
